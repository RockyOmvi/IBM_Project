<!DOCTYPE html>
<html lang="en" class="h-full">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RepoFinder - Search Repositories</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Manrope:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html {
            font-family: 'Inter', sans-serif;
        }

        ::selection {
            background: #3b82f6;
            color: #ffffff;
        }

        .font-manrope {
            font-family: 'Manrope', sans-serif;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease-in;
        }

        .modal-content {
            background-color: #171717;
            margin: 10% auto;
            padding: 32px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease-out;
            border: 1px solid #262626;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>

<body class="min-h-full antialiased bg-neutral-950 text-neutral-300">
    <div class="fixed inset-0 w-full h-screen"><iframe
            src="https://my.spline.design/unchained-d3hHCgdWho7a8ATGzKtB11TU/" frameborder="0" width="100%"
            height="100%"></iframe></div>

    <main class="relative mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-3">
                <a href="/" class="text-2xl font-manrope font-bold text-white">RepoFinder</a>
                <span
                    class="px-2 py-1 text-xs rounded-full bg-blue-500/10 border border-blue-500/20 text-blue-400">Beta</span>
            </div>
            <a href="/" class="text-sm text-neutral-400 hover:text-white transition-colors">‚Üê Back to Home</a>
        </div>

        <!-- Main Chat Container -->
        <div
            class="relative border backdrop-blur-xl rounded-2xl shadow-2xl overflow-hidden bg-neutral-900/90 border-neutral-800/80">
            <!-- Chat Header -->
            <div class="px-6 py-4 border-b bg-neutral-900/80 border-neutral-800">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="w-5 h-5 text-white">
                                <path d="m21 21-4.34-4.34"></path>
                                <circle cx="11" cy="11" r="8"></circle>
                            </svg>
                        </div>
                        <div>
                            <h2 class="text-sm font-medium text-white">Repository Search</h2>
                            <p class="text-xs text-neutral-400">Powered by GitHub API</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full bg-green-500"></div>
                        <span class="text-xs text-neutral-400">Connected</span>
                    </div>
                </div>
            </div>

            <!-- Messages Area -->
            <div class="px-6 py-6 min-h-[500px] max-h-[600px] overflow-y-auto bg-neutral-900/40" id="messages">
                <!-- Welcome Message -->
                <div class="mb-6 p-4 rounded-lg bg-blue-500/10 border border-blue-500/20">
                    <div class="flex items-start gap-3">
                        <div class="w-8 h-8 rounded-lg bg-blue-500/20 flex items-center justify-center flex-shrink-0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="w-4 h-4 text-blue-400">
                                <circle cx="12" cy="12" r="10"></circle>
                                <path d="M12 16v-4"></path>
                                <path d="M12 8h.01"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-sm text-neutral-200 font-medium mb-1">Welcome to RepoFinder!</p>
                            <p class="text-xs text-neutral-400">Search for any GitHub repository by technology,
                                framework, or topic. Try "React frameworks" or "Python machine learning".</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Repository Results Grid -->
            <div class="px-6 py-4 border-t border-neutral-800/50 bg-neutral-900/20" id="repo-results-container"
                style="display: none;">
                <div class="mb-3 flex items-center justify-between">
                    <h3 class="text-sm font-medium text-white">Search Results</h3>
                    <span class="text-xs text-neutral-500" id="results-count"></span>
                </div>
                <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3" id="repo-results"></div>
            </div>

            <!-- Input Area -->
            <div class="px-6 py-4 border-t bg-neutral-900/60 border-neutral-800/50">
                <form id="inputForm" class="flex items-center gap-3">
                    <div class="flex-1 relative">
                        <input type="text" id="inputText" placeholder="Search for repositories..."
                            class="w-full px-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 text-neutral-200 placeholder-neutral-500 focus:outline-none focus:border-blue-500/50 focus:bg-neutral-800 transition-all"
                            autocomplete="off" />
                    </div>
                    <button type="submit"
                        class="px-6 py-3 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium hover:shadow-lg hover:shadow-blue-500/50 transition-all duration-200 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            class="w-4 h-4">
                            <path d="m21 21-4.34-4.34"></path>
                            <circle cx="11" cy="11" r="8"></circle>
                        </svg>
                        Search
                    </button>
                </form>
                <p class="text-xs text-neutral-500 mt-2">Press Enter to search</p>
            </div>
        </div>
    </main>

    <script>
        (() => {
            const messagesEl = document.getElementById("messages");
            const resultsEl = document.getElementById("repo-results");
            const resultsContainer = document.getElementById("repo-results-container");
            const resultsCount = document.getElementById("results-count");
            const form = document.getElementById("inputForm");
            const input = document.getElementById("inputText");
            let session_id = null;
            let currentRepos = [];

            function addMessage(text, role = "user") {
                const div = document.createElement("div");
                div.className = "mb-4 flex items-start gap-3 " + (role === "user" ? "justify-end" : "");

                if (role === "user") {
                    div.innerHTML = `
        <div class="max-w-md px-4 py-3 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500 text-white">
          <p class="text-sm">${escapeHtml(text)}</p>
        </div>
      `;
                } else {
                    div.innerHTML = `
        <div class="w-8 h-8 rounded-lg bg-neutral-800 flex items-center justify-center flex-shrink-0">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-neutral-400"><path d="M12 8V4H8"></path><rect width="16" height="12" x="4" y="8" rx="2"></rect><path d="M2 14h2"></path><path d="M20 14h2"></path><path d="M15 13v2"></path><path d="M9 13v2"></path></svg>
        </div>
        <div class="max-w-md px-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700">
          <p class="text-sm text-neutral-200">${escapeHtml(text)}</p>
        </div>
      `;
                }

                messagesEl.appendChild(div);
                messagesEl.scrollTop = messagesEl.scrollHeight;
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            function renderResults(results, source) {
                resultsEl.innerHTML = "";
                if (!results || results.length === 0) {
                    resultsContainer.style.display = "none";
                    return;
                }

                resultsContainer.style.display = "block";
                resultsCount.textContent = `${results.length} repositories found`;
                currentRepos = results;

                results.forEach((r, index) => {
                    const card = document.createElement("div");
                    card.className = "p-4 rounded-lg border border-neutral-800 bg-neutral-900/50 hover:border-blue-500/50 transition-all cursor-pointer";
                    card.onclick = () => showRepoModal(r);

                    card.innerHTML = `
        <div class="flex items-start justify-between mb-2">
          <h4 class="text-sm font-medium text-blue-400 truncate">${escapeHtml(r.owner)}/${escapeHtml(r.name)}</h4>
        </div>
        <p class="text-xs text-neutral-400 line-clamp-2 mb-3">${escapeHtml(r.description || 'No description available')}</p>
        <div class="flex items-center gap-3 text-xs text-neutral-500">
          <span class="flex items-center gap-1">‚≠ê ${r.stars || 0}</span>
          ${r.language ? `<span>üìù ${escapeHtml(r.language)}</span>` : ''}
        </div>
      `;

                    resultsEl.appendChild(card);
                });
            }

            function showRepoModal(repo) {
                const modal = document.createElement("div");
                modal.className = "modal";
                modal.id = "repoModal";

                modal.innerHTML = `
      <div class="modal-content">
        <div class="flex items-start justify-between mb-6">
          <div>
            <h2 class="text-xl font-manrope font-semibold text-white mb-2">${escapeHtml(repo.owner)}/${escapeHtml(repo.name)}</h2>
            <p class="text-sm text-neutral-400">${escapeHtml(repo.description || 'No description available')}</p>
          </div>
          <button class="close text-neutral-500 hover:text-white text-2xl leading-none">&times;</button>
        </div>
        
        <div class="mb-6">
          <label class="text-xs text-neutral-500 mb-2 block">Clone Command</label>
          <div class="flex items-center gap-2 px-3 py-2 rounded-lg bg-neutral-800 border border-neutral-700">
            <code class="flex-1 text-xs text-neutral-300 overflow-x-auto">git clone ${escapeHtml(repo.url)}.git</code>
            <button class="copy-btn px-3 py-1 text-xs rounded bg-blue-500 text-white hover:bg-blue-600 transition-colors">Copy</button>
          </div>
        </div>
        
        <div class="flex gap-3">
          <button class="preview-btn flex-1 px-4 py-3 rounded-lg bg-gradient-to-r from-blue-500 to-purple-500 text-white font-medium hover:shadow-lg hover:shadow-blue-500/50 transition-all flex items-center justify-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg>
            Preview on GitHub
          </button>
          <button class="close-btn px-4 py-3 rounded-lg border border-neutral-700 text-neutral-300 hover:bg-neutral-800 transition-colors">Close</button>
        </div>
      </div>
    `;

                document.body.appendChild(modal);

                setTimeout(() => {
                    modal.style.display = "block";
                }, 10);

                const closeBtn = modal.querySelector(".close");
                const closeBtnBottom = modal.querySelector(".close-btn");
                const copyBtn = modal.querySelector(".copy-btn");
                const previewBtn = modal.querySelector(".preview-btn");

                closeBtn.onclick = () => closeModal();
                closeBtnBottom.onclick = () => closeModal();

                copyBtn.onclick = () => {
                    const command = `git clone ${repo.url}.git`;
                    navigator.clipboard.writeText(command).then(() => {
                        copyBtn.textContent = "Copied!";
                        copyBtn.classList.add("bg-green-500");
                        setTimeout(() => {
                            copyBtn.textContent = "Copy";
                            copyBtn.classList.remove("bg-green-500");
                        }, 2000);
                    });
                };

                previewBtn.onclick = () => {
                    window.open(repo.url, '_blank');
                    closeModal();
                };

                modal.onclick = (e) => {
                    if (e.target === modal) {
                        closeModal();
                    }
                };
            }

            function closeModal() {
                const modal = document.getElementById("repoModal");
                if (modal) {
                    modal.style.display = "none";
                    setTimeout(() => modal.remove(), 300);
                }
            }

            async function postChat(text) {
                addMessage(text, "user");

                // Add loading message
                const loadingDiv = document.createElement("div");
                loadingDiv.className = "mb-4 flex items-start gap-3";
                loadingDiv.id = "loading-message";
                loadingDiv.innerHTML = `
      <div class="w-8 h-8 rounded-lg bg-neutral-800 flex items-center justify-center flex-shrink-0">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 text-neutral-400 animate-spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"></path></svg>
      </div>
      <div class="px-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700">
        <p class="text-sm text-neutral-400">Searching repositories...</p>
      </div>
    `;
                messagesEl.appendChild(loadingDiv);
                messagesEl.scrollTop = messagesEl.scrollHeight;

                try {
                    const res = await fetch("/api/chat", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ text, session_id })
                    });

                    // Remove loading message
                    const loading = document.getElementById("loading-message");
                    if (loading) loading.remove();

                    if (!res.ok) {
                        const err = await res.text();
                        addMessage("Error: " + err, "bot");
                        return;
                    }

                    const data = await res.json();
                    session_id = data.session_id;

                    const sourceText = data.source === "deepseek" ? "Results from Deepseek AI" :
                        data.source === "github" ? "Results from GitHub API" :
                            "Showing sample results";
                    addMessage(sourceText, "bot");
                    renderResults(data.results, data.source);
                } catch (error) {
                    const loading = document.getElementById("loading-message");
                    if (loading) loading.remove();
                    addMessage("Connection error. Please try again.", "bot");
                }
            }

            form.addEventListener("submit", e => {
                e.preventDefault();
                const t = input.value.trim();
                if (!t) return;
                input.value = "";
                postChat(t);
            });

            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeModal();
                }
            });
        })();
    </script>
</body>

</html>